<!-- File: Input.html -->
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Input - Credit Card Fraud Detector</title>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial; margin: 0; background: #f6f8fb; }
    .card { max-width: 800px; margin: 3rem auto; background: white; padding: 2rem; border-radius: 12px; box-shadow: 0 8px 30px rgba(20,30,70,0.08); }
    h1 { margin-top: 0; }
    label { display: block; margin: 0.5rem 0 0.25rem; }
    input, button { width: 100%; padding: 0.6rem; border-radius: 8px; border: 1px solid #e2e8f0; }
    .row { display: grid; grid-template-columns: 1fr 1fr; gap: 0.75rem; }
    button { background: #2563eb; color: white; font-weight: 600; cursor: pointer; border: none; }
    button:hover { background: #1e40af; }
    .actions { display: flex; gap: 0.75rem; margin-top: 1rem; }
    .muted { color: #6b7280; font-size: 0.9rem; }
    hr { margin: 1.5rem 0; }
  </style>
</head>
<body>
  <main class="card">
    <h1>Provide Transaction Input</h1>
    <p class="muted">Upload a CSV file with transactions or enter a single transaction manually.</p>

    <!-- CSV Upload -->
    <h3>CSV Upload</h3>
    <p class="muted">Required columns: TransactionID, Amount, MerchantID, TransactionType, Location</p>
    <input type="file" id="csvFile" accept=".csv">
    <div class="actions">
      <button id="uploadBtn">Upload & Predict</button>
      <button type="button" onclick="document.getElementById('csvFile').value=''">Clear</button>
    </div>

    <hr>

    <!-- Single Transaction Form -->
    <h3>Single Transaction</h3>
    <form id="singleForm">
      <div class="row">
        <div>
          <label for="txid">TransactionID</label>
          <input id="txid" name="txid" required>
        </div>
        <div>
          <label for="amount">Amount</label>
          <input id="amount" name="amount" type="number" step="0.01" required>
        </div>
      </div>

      <div class="row">
        <div>
          <label for="merchant">MerchantID</label>
          <input id="merchant" name="merchant" required>
        </div>
        <div>
          <label for="type">TransactionType</label>
          <input id="type" name="type" placeholder="e.g. purchase" required>
        </div>
      </div>

      <div class="row">
        <div>
          <label for="location">Location</label>
          <input id="location" name="location" placeholder="e.g. Mumbai" required>
        </div>
      </div>

      <div class="actions">
        <button type="submit">Predict</button>
        <button type="button" onclick="window.location='Welcome.html'">Back</button>
      </div>
    </form>

    <div id="status" class="muted" style="margin-top:1rem"></div>
  </main>

  <script>
    const statusEl = document.getElementById('status');
    function setStatus(msg, error=false) {
      statusEl.textContent = msg;
      statusEl.style.color = error ? "crimson" : "#374151";
    }

    // CSV upload
    document.getElementById('uploadBtn').addEventListener('click', async (e) => {
      e.preventDefault();
      const file = document.getElementById('csvFile').files[0];
      if (!file) { setStatus("Please select a CSV file.", true); return; }

      setStatus("Uploading CSV...");
      const formData = new FormData();
      formData.append("file", file);

      try {
        const resp = await fetch("/predict_csv", { method: "POST", body: formData });
        if (!resp.ok) throw new Error("Server error " + resp.status);
        const json = await resp.json();
        sessionStorage.setItem("predictResults", JSON.stringify(json));
        window.location = "output.html";
      } catch (err) {
        setStatus("Error: " + err.message, true);
      }
    });

    // Single transaction form
    document.getElementById('singleForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const payload = {
        TransactionID: document.getElementById("txid").value,
        Amount: parseFloat(document.getElementById("amount").value),
        MerchantID: document.getElementById("merchant").value,
        TransactionType: document.getElementById("type").value,
        Location: document.getElementById("location").value
      };

      setStatus("Sending request...");
      try {
        const resp = await fetch("/predict", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload)
        });
        if (!resp.ok) throw new Error("Server error " + resp.status);
        const json = await resp.json();
        sessionStorage.setItem("predictResults", JSON.stringify([json]));
        window.location = "output.html";
      } catch (err) {
        setStatus("Error: " + err.message, true);
      }
    });
  </script>
</body>
</html>
